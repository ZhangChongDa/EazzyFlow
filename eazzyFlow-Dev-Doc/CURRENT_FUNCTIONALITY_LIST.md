# 当前代码功能现状详细清单

> **更新时间**: 2026-01-02
> **目的**: 这里的每一条都经过了代码级的核查，准确区分了“真功能”和“假演示”。供 AI 团队进行下一步开发规划使用。

## 1. 核心业务模块

### 🔐 登录 (Login)
*   **[真实]** 完整对接了 Supabase Auth。
*   支持邮箱/密码登录和注册。
*   注册时会自动触发数据库生成的 Profile 记录。

### 🏠 仪表盘 (Dashboard)
*   **[混合]** 部分真实，部分模拟。
*   **真实**: 收入 (Revenue) 和 活跃用户 (Active Audience) 均实时聚合自数据库。
*   **真实**: AI 待办任务 (AI Tasks) 是实时扫描数据库发现的真实流失风险用户。
*   **演示**: “总投资” (Total Investment) 是写死的 $45,000，导致 ROI 计算虽然基于真实收入，但成本端是假的。

### 📊 分析报表 (Analytics)
*   **[纯演示]** 🚨 注意：此页面目前完全是静态的。
*   所有图表数据（趋势图、气泡图、归因分析）都来自代码中的 `MOCK_DATA` 常量。
*   不会读取真实的历史营销效果。

### 🎨 画布 (Campaign Canvas)
*   **[混合]** 具备核心交互能力，执行端受限。
*   **真实**: 活动流程图的保存与加载 (Save/Load) 均走真实数据库 (`campaigns` 表)。
*   **真实**: 所谓“受众估算” (Audience Size) 是真的去查询数据库，统计符合条件的用户数。
*   **真实**: 为了演示效果闭环，它可以实时监听 `campaign_logs` 表的变动来实现“实时日志”弹窗。
*   **半真实**: 侧边栏的“渠道配置”目前更多是 UI 状态，尚未完全映射到执行参数。
*   **受限**: 实际点击执行时，邮件只会发给硬编码的测试邮箱 (`delivered@resend.dev`)。

### ✍️ 内容工作室 (Content Studio)
*   **[真实]** 全功能 AI 对接。
*   **文案**: 调用 DeepSeek (Gemini Service) 生成营销短信。
*   **生图**: 调用 Fal.ai (Flux.1) 进行图片生成和修改。
*   *注意：需要配置好 `.env` 中的 API Key 才能工作，否则会报错。*

### �️ 商品目录 (Product Catalog)
*   **[混合]** 读真写假。
*   **读取**: 在应用启动时，会尝试从 Supabase 的 `products` 和 `coupons` 表拉取真实数据。如果拉不到，会回退到 Mock 数据，保证不白屏。
*   **写入**: 目前点击“保存”或“新建商品”，**仅仅更新了前端的 React 状态**，并没有回写到数据库。刷新页面后新增的商品会丢失。

### 👥 客户 360 (Customer Profile)
*   **[真实]** 数据完全真实。
*   列表页支持服务端分页。
*   详情页的生命周期计算、用户画像 (DNA) 均基于数据库中的真实字段 (`arpu`, `created_at` 等) 实时计算。

### 🎯 细分人群 (Audience Studio)
*   **[混合]** AI 洞察真，筛选器假。
*   **真实**: “AI 机会挖掘” (Opportunity Hunter) 是真的在分析 `useAudienceOpportunities` 钩子里的数据模式（如：高流量低语音=游戏玩家）。
*   **演示**: 下方的“通过标签筛选用户”目前是纯前端 UI 交互。右下角的“预计覆盖人数”是写死的一个数学公式 `(12500 - 过滤器数量 * 1500)`，不是真实的数据库查询结果。

### 🤖 聊天助手 (Chat Assistant)
*   **[真实]** 真实 RAG 能力。
*   点击发送时，会先抓取当前的业务上下文 (`contextService`)，然后连同用户问题一起发给 DeepSeek 大模型。
*   支持打字机效果的流式输出。

---

## 2. 总结与改进路线

目前系统就像一个**精装修的样板间**：
1.  **门面 (UI)** 非常漂亮完整。
2.  **水电 (Auth/AI/Read)** 已经通了，能看到真实数据在流动。
3.  **部分家具 (Write/Analytics)** 还是纸糊的，只能看不能真正用。

**下一步建议 (Priority List)**:
1.  **修复写操作**: 将 `ProductCatalog` 的“保存”动作改为真实的数据库 Upsert 操作。
2.  **打通筛选器**: 将 `AudienceStudio` 的前端筛选条件转换为真实的 Supabase SQL 查询，让“预计覆盖人数”变真实。
3.  **解锁执行**: 移除 `CampaignExecution` 中的测试邮箱限制（需配合风险控制开关）



## 本次项目的目标
### 1. 我们需要将当前的系统全面优化为全部可以真实执行的 MccM DEMO 版本，
### 2. MccM DEMO 版本的核心是以 @CampaignCanvas.tsx 为重点，用户能够在该页面提供的无限画布创建各种营销活动，并且这些营销活动可以在DEMO环节真实的执行，并且在执行过程中获得用户反馈后，能够将用户的反馈作为活动效果的数据，给出实际的分析结果。


### 3. @CampaignCanvas.tsx 中包括下述核心的配置节点：
- 请深入分析 @CampaignCanvas.tsx 营销活动创建页面中所提供的全部配置节点的代码，然后给出各个节点当前的实际功能进展，也就是说这个节点是否能够达到真实演示的标准，你需要给出评估结以及背后分析的简要逻辑。

- 请现场进行EazzyFlow DEMO 视角反向思考 我们应该设计哪些场景案例，才能够充分展示EazzyFlow的全部功能，并且这些功能符合移动运营商的业务发展需求。
- 我们需要在DEMO的现场，让打算购买该产品的客户，感受到Wow Moment，评估本产品需要需要在哪些功能点上进行优化。
- 目前 @CampaignCanvas.tsx 还远远没有到达可以演示的状态，更不要说WoW Moment

### 4. @CampaignCanvas.tsx 的全面介绍：
1. Segment: 这个节点用于定义Who, 也就是本次创建的营销活动面向的是谁？当前的节点的交互不完整，体验远达不到DEMO的要求，
用户通过Segment节点定义本次的Campaign最大规模下，面向哪些客户群。例如，我们可以选择： 
- 区域在Yangong，
- 年龄：不限制年龄，
- 性别：男女不限制，
- 下述三个条件满足其中一个：
-- Subscription: Prepaid, Postpaid
-- Tier: 用户Tier是 Diamong 或 Crown,  
-- Tenure:  用户需要是使用我们的服务超过一年以上，
-- Segment: High Data User 
- 活跃度：用户在近30天内，没有使用过我们的服务，包括语音服务，数据流量，家庭宽带等，
- ARPU 用户ARPU在21000Ks(我们按照5000缅币 == 1 USD ),
备注：请考虑如何在当前的节点中创建WoW Moment，目前提供了基于用户的选择，自动计算涉及的目标客户的数量，不知道是否还有其他的功能点可以构成WoW，例如给出选择出来的用户表单，可以是仅前10个，用于用户检查以及核对。
-该节点当前的问题：
-- 整体交互没有达到 MD3 的 就应如此的 交互逻辑，
-- 功能上不支持 或条件，
-- 对于当前众多的筛选条件，同时筛选条件又可以进行And/Or的情况下，当前的节点的布局，交互都非常不友好
-- 当前 WoW moment 默认是看不到或者看不全的，
-- 该节点提供的Save，Delete的按钮并不工作，
-- 其他的问题目前由于问题太多仅仅罗列了最明显的，因此需要你进一步推理分析可以优化的地方，
-- 用户的状态需要添加时间周期，例如 Active，那么就需要限定在近30天，本月月，近7天，当前这是没有的。同样的逻辑对于用户的ARPU是否也生效，例如该用户使用了2年的服务，但在近3个月的ARPU已经到了5美金。另外需要给出按照上升或者下降百分比的模式，例如 近三个月的APRU提升了30%，且 ARPU 已经在 6-10美金这个区间，
- 在当前的多条件创建的页面中是否可以采用由用户选择添加新的条件后，选择不同的条件类型，再创建条件呢。
- 这些条件是否可以构建一个原子条件库，用户可以像搭积木一样，灵活的大家出来。

2. Trigger： 这个节点用于定义 when，也就是面向当前的人群，当这些人群中的用户，在达到一个什么情况的时候，才真正触发营销的动作。下面是具体的触发条件说明，整体的条件分为下面 XX 类型：
- 业务类型：
-- 电信业务使用情况：语音通话多少分钟，数据流量使用了多少GB，短信发送了多少条，
-- 电信业务的套餐订购情况：购买了10GB的流量包，购买了30分钟的语音包，订购了10美金每月的游戏套餐（20G流量，500分钟通话，200条短信），订购了15美金的商务套餐（40G流量，1000分钟通过，300条短信）
-- 电信业务的近期充值情况：例如充值了多少 缅币/ks 
-- 电信业务的投诉情况，是否近期给MPT打过业务咨询电话，是否近期进行过投诉，
-- 电信业务使用量的变动： 同比上升或者下降 XX%，
-- 备注： 上述每一个触发点都需要和时间周期相绑定，例如近一周，近一个月等，或者特定的时间周期

- 用户状态类：
-- 用户当前所在什么位置，例如，Myanmar Plaza周边 5公里（在圣诞节的时候），
-- 用户近期重度使用什么样的App，例如，通过用户访问的API地址，来判断，facebook.com等，
-- 用户是否通过积分购买MPT Club中的积分商品，
-- 备注： 上述每一个触发点都需要和时间周期相绑定，例如近一周，近一个月等，或者特定的时间周期

- 明确的周期：
-- 只要在规定的时间，就触发这个动作。这类时间的定义有下述几个类型
--- 特定的日期和时间，例如 2025年11月11日 0点到24:00
--- 特定的时间窗口：例如从1月2日到1月10日，同时在这个周期里，定义具体的时间点，8:00PM - 22:00 PM，
--- 这个可以是一个时间窗口，也可以是一个重复的周期，例如 Happy Friday，例如：每周五的晚上7点到9点，并且可以现在这个周期的开始和结束时间，或者一直延续不停止。

3. Action: 这个节点用于定义 what，也就是当触发条件达成的时候，需要执行什么动作。当前的节点的交互不完整，体验远达不到DEMO的要求，用户通过Action节点定义本次的Campaign在所面向的客户群中，当其中的用户满足触发条件达成的时候，需要执行什么动作。目前的动作主要包括两大类型
- 信息类的：就是向用户发送信息，该类型信息不需要去分析用户的响应动作，因为是单向信息发送，例如：
--- 用户最近使用了我们的服务，那么可以向用户发送使用指南，
--- 用户当前的账户余额低于500ks的时候，我们发送给到用户充值的方法指南，
- 营销类的：就是向用户发送营销信息，这些信息是激活用户继续使用我们的服务，或者是购买优惠的产品，或者是推荐他喜欢的产品，营销类型的信息包括
--- 移动运营商 Package产品，这类产品可以直接线上购买，购买后立即开通，例如 50G的流量包，20分钟的语音通话包，100G 的游戏流量包等等，这类信息中会包含产品信息和购买链接，用户可以点击购买链接一键购买，购买后立即生效，
--- 移动运营商 实体产品，这类产品多半是绑定移动运营商核心业务的，例如 选购 MPT 12月的资费套餐送手机，这就是订购阅读套餐送手机的模式，这类信息中会包含产品信息和购买链接，用户可以点击购买链接一键购买，购买后立即生效。用户当即销售新的套餐，手机直接邮寄到家。也会有直接购买的产品，例如家庭摄像头，手机壳等，实体产品。
--- 各类促销优惠券：这类优惠券可以是移动运营商的核心产品的优惠券，例如，语音通话包，数据流量包等等，也可以是与第三方的生态合作伙伴合作的优惠券，例如，MPT * 星巴克 优惠券，这类优惠券大部分是去线下消费的，例如，用户到了星巴克把MPT联名的Coupon Code给到店员，店员核验Coupon Code后就可以享受8折优惠购买一杯咖啡。
--- MPT Club 积分：直接赠送会员积分，获得的积分可以在MPT Club中兑换 MPT Club商城提供的产品。积分类激励一般都会设定消费期限，例如三天内，用户领取到该 特别的积分后，可以直接进入MPT Club进行兑换。如果三天内没有完成兑换，那么该积分则自动作废。

--- 注意：
---- 所有的产品，Coupon，都可以通过 @ProductCatalog.tsx 文件进行管理和创建。
---- 该节点的交互和页面的布局依旧需要完善，同时该节点的保存和删除按钮不工作

4. Channel: 这个节点主要用于定义where，也就是用于第三步的Action通过哪个渠道发送出去，当前前端显示的渠道包括 SMS，Push，Email，Chatbox, App push, Facebook, Instagram, Linkedin。该节点主要承担两个重要的作用
--- 将 Action 节点中 需要发送的内容（包括营销的信息），通过AI生成适合不同渠道的内容，并结合产品链接。对于本次demo，我们打算通过邮件这个渠道发送。如果，在Action节点中定义了发送一个 节日祝福，那么AI就会基于这个核心内容撰写一篇节日祝福，适合邮件渠道的内容形式。并最终发送出去。
--- 将 Action 节点的信息，确认通过哪个渠道进行发布。
-- 问题优化：
--- 当前的AI优化内容部分并没有真正起作用，邮件样式也需要由AI进行美化
--- 优化后的内容通过邮件发送出去也没有真正起作用，虽然已经配置了邮件服务的API Key，

5. Wait：该节点就是用于等待的节点，当前面Action的动作已经通过Channel发送后，考虑到运营商的客户规模一般都会等待1到3天，然后才能确认本次营销的效果。也就是本次活动参与的人群，因此才会有一个等待按钮。当前等待按钮的功能。目前该按钮的功能基本满足demo的需求。

6. Logic: 该节点是一个逻辑判断阶段，主要存在两个用途
- 检查前面设定的Action是否已经执行的结果做条件跳转， 例如，前面的Action 设定的是一个Data Pacakge的产品，如果用户购买了，那么这个节点的检查结果就是True，否则就是False。这两种情况都能够进入不同的分支，继续创建新的Action，新的Channel，新的Wait，新的Logic，
- 当前节点的问题：
--- 没有基于上一个Action节点的动作，构建判断。例如上一个节点是发送给用户一个 500GB Data Package，那么当前的节点的处理逻辑就是。条件自动构建为购买 500GB Data Package，Yes or No, Yes 入口走一个分支，No 入口走一个分支。而不需要再次创建如何复杂的条件。同时在这个基础上可以添加User Profile的 AND 或者是 Or的条件，进一步锁定精准用户群，
--- User Profile 不能单独构建一个条件，但是可以在主条件下面添加二次过滤，例如 已经购买了这个产品的用户，我们还可以进行二次过滤，例如，是否APRU大于20，如果是走Yes，如果不是走No。对于没有购买的也是一个逻辑，那么这个节点就同步由4个出口分支

--- 该节点设计好的地方就是，能够添加删除条件，这符合新的设计理解。不好的地方是，每个条件的创建不够智能，条件值需要跟着条件变化，例如 用户的条件是Tier，那么条件值需要是Crown, Diamond, Gold, Silver,这类型的，而不是用户手动输入。


